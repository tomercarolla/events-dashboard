const a6_0x488b=['taskId','Fetching\x20tasks...','execSync','Duplicate\x20Agent\x20ID\x20Detected','map','CIRCLECI','done','note','message','child_process','NO_MESSAGES_TIMEOUT','status','defineProperty','then','projects','../../error/print-run-group-error','join','.lock','getRunGroup','push','Waiter','../../../utilities/create-unchanged-value-timeout','VERBOSE_LOGGING','Agent\x20was\x20terminated\x20via\x20SIGTERM','tasksRunnerOptions','maxParallel','length','maxParallel:\x20','getTime','error','printRunGroupError','../../../utilities/nx-imports','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','criticalErrorMessage','env','NX_AGENT_NAME','\x20--projects=','../../../utilities/waiter','CIRCLE_STAGE','executionId:\x20','Agent\x20','params','completeRunGroupWithError','floor','executionId','random','throw','SIGINT','completed:\x20','parse','startAgent','/tasks-hashes-','npx\x20nx\x20run-many\x20--target=','existsSync','If\x20you\x20believe\x20this\x20is\x20the\x20case,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22.','cacheDirectory','configuration','__awaiter','SIGTERM','completedTasks','includes','Command\x20execution\x20failed\x20(distributed\x20task\x20execution:\x20','CIRCLE_JOB','options','./distributed-agent.api','writeFileSync','DistributedAgentApi','NO_FURTHER_TASKS_TO_RUN','exit','readFileSync','We\x20have\x20detected\x20another\x20agent\x20with\x20this\x20ID\x20running\x20in\x20this\x20workspace.\x20This\x20should\x20not\x20happen.',').\x20Tasks\x20hashes\x20haven\x27t\x20been\x20recorded.','--configuration=','../../../utilities/metric-logger','Executing:\x20\x27','error:\x20','Critical\x20Error\x20in\x20Agent:\x20\x22','value','target','strip-json-comments','find','assign','submitRunMetrics','mkdirSync','Starting\x20an\x20agent\x20for\x20running\x20Nx\x20tasks','default','next','completedStatusCode','inherit','wait','retryDuring','../../../utilities/environment','toString','End\x20all\x20currently\x20running\x20agents,\x20run\x20\x22npx\x20nx-cloud\x20clean-up-agents\x22,\x20and\x20try\x20again.','reset','/lockfiles','Error:','number\x20of\x20tasks:\x20','warn','unlinkSync','./node_modules/.cache/nx','Other\x20Nx\x20Cloud\x20Agents\x20Detected','/nx.json','projectName','completed','forEach'];(function(_0xc5c8e7,_0x488ba7){const _0x123dd1=function(_0x244dd3){while(--_0x244dd3){_0xc5c8e7['push'](_0xc5c8e7['shift']());}};_0x123dd1(++_0x488ba7);}(a6_0x488b,0x97));const a6_0x123d=function(_0xc5c8e7,_0x488ba7){_0xc5c8e7=_0xc5c8e7-0x0;let _0x123dd1=a6_0x488b[_0xc5c8e7];return _0x123dd1;};'use strict';var __awaiter=this&&this[a6_0x123d('0xc')]||function(_0x4b796c,_0x1cdfc1,_0x5250dc,_0x3ba425){function _0x56ff47(_0x446c97){return _0x446c97 instanceof _0x5250dc?_0x446c97:new _0x5250dc(function(_0x2f37fe){_0x2f37fe(_0x446c97);});}return new(_0x5250dc||(_0x5250dc=Promise))(function(_0x5f5ad4,_0x3f602e){function _0x435f35(_0xb11a04){try{_0x295897(_0x3ba425['next'](_0xb11a04));}catch(_0x22779a){_0x3f602e(_0x22779a);}}function _0x45c37e(_0x255e58){try{_0x295897(_0x3ba425[a6_0x123d('0x1')](_0x255e58));}catch(_0xe57c9d){_0x3f602e(_0xe57c9d);}}function _0x295897(_0x29ac81){_0x29ac81[a6_0x123d('0x43')]?_0x5f5ad4(_0x29ac81['value']):_0x56ff47(_0x29ac81[a6_0x123d('0x20')])[a6_0x123d('0x4a')](_0x435f35,_0x45c37e);}_0x295897((_0x3ba425=_0x3ba425['apply'](_0x4b796c,_0x1cdfc1||[]))[a6_0x123d('0x29')]());});};Object[a6_0x123d('0x49')](exports,'__esModule',{'value':!![]});exports[a6_0x123d('0x5')]=void 0x0;const child_process_1=require(a6_0x123d('0x46'));const fs_1=require('fs');const stripJsonComments=require(a6_0x123d('0x22'));const create_unchanged_value_timeout_1=require(a6_0x123d('0x52'));const environment_1=require(a6_0x123d('0x2e'));const metric_logger_1=require(a6_0x123d('0x1c'));const waiter_1=require(a6_0x123d('0x62'));const print_run_group_error_1=require(a6_0x123d('0x4c'));const distributed_agent_api_1=require(a6_0x123d('0x13'));const {output,workspaceRoot}=require(a6_0x123d('0x5c'));function executeTasks(_0x4619e3,_0x3cfcd8){return __awaiter(this,void 0x0,void 0x0,function*(){let _0x12b88a=0x0;let _0x395428=null;const _0x367770=(0x0,create_unchanged_value_timeout_1['createUnchangedValueTimeout'])({'title':'No\x20new\x20messages\x20received\x20after\x20'+environment_1[a6_0x123d('0x47')]/0x3e8+'\x20seconds','timeout':environment_1[a6_0x123d('0x47')]});const _0x305238=new waiter_1[(a6_0x123d('0x51'))]();let _0x44b282=[];const _0x5ee7b6=new Date();let _0x3f52a6=![];while(!![]){if(environment_1[a6_0x123d('0x53')]){output[a6_0x123d('0x44')]({'title':a6_0x123d('0x3e')});}_0x395428=yield _0x3cfcd8['tasks'](_0x395428?_0x395428[a6_0x123d('0x69')]:null,_0x12b88a,_0x44b282);if(environment_1[a6_0x123d('0x53')]){output['note']({'title':'API\x20Response','bodyLines':[a6_0x123d('0x3')+_0x395428[a6_0x123d('0x3b')],'status:\x20'+_0x395428[a6_0x123d('0x48')],'retryDuring:\x20'+_0x395428['retryDuring'],a6_0x123d('0x64')+_0x395428[a6_0x123d('0x69')],a6_0x123d('0x34')+_0x395428['tasks'][a6_0x123d('0x57')],a6_0x123d('0x1e')+_0x395428[a6_0x123d('0x5e')],a6_0x123d('0x58')+_0x395428['maxParallel']]});}if(_0x395428['criticalErrorMessage']){output[a6_0x123d('0x5a')]({'title':'Distributed\x20Execution\x20Terminated','bodyLines':[a6_0x123d('0x33'),_0x395428[a6_0x123d('0x5e')]]});process[a6_0x123d('0x17')](0x0);}if((_0x395428===null||_0x395428===void 0x0?void 0x0:_0x395428[a6_0x123d('0x2d')])&&(_0x395428===null||_0x395428===void 0x0?void 0x0:_0x395428[a6_0x123d('0x2d')])!==0x0&&!_0x3f52a6&&new Date()[a6_0x123d('0x59')]()-_0x5ee7b6[a6_0x123d('0x59')]()>_0x395428['retryDuring']){yield _0x305238[a6_0x123d('0x2c')]();continue;}if((_0x395428===null||_0x395428===void 0x0?void 0x0:_0x395428[a6_0x123d('0x48')])!==undefined){if(_0x395428[a6_0x123d('0x48')]==='RUN_GROUP_COMPLETED'||_0x395428[a6_0x123d('0x48')]===a6_0x123d('0x16')){return;}}else if(_0x395428[a6_0x123d('0x3b')]){return;}_0x367770(_0x395428['tasks'][a6_0x123d('0x41')](_0x3c16db=>_0x3c16db[a6_0x123d('0x3d')])[a6_0x123d('0x4d')](''));if(!_0x395428[a6_0x123d('0x69')]){if(environment_1['VERBOSE_LOGGING']){output['note']({'title':'Waiting...'});}yield _0x305238[a6_0x123d('0x2c')]();_0x12b88a=0x0;_0x44b282=[];continue;}_0x305238[a6_0x123d('0x31')]();_0x3f52a6=!![];const _0x85a245=invokeTasksUsingRunMany(_0x4619e3,_0x395428[a6_0x123d('0x69')],_0x395428['tasks'],_0x395428[a6_0x123d('0x56')]);_0x12b88a=_0x85a245[a6_0x123d('0x2a')];_0x44b282=_0x85a245[a6_0x123d('0xe')];}});}function readCompletedTasks(_0x4c0e32,_0xfcaa4b){const _0x4a033c=a6_0x123d('0x10')+_0xfcaa4b+a6_0x123d('0x1a');let _0x502159;try{const _0x41f4e0=_0x4c0e32[a6_0x123d('0xa')]||'./node_modules/.cache/nx';const _0x1e9bfc=_0x41f4e0+a6_0x123d('0x6')+_0xfcaa4b;_0x502159=JSON[a6_0x123d('0x4')]((0x0,fs_1[a6_0x123d('0x18')])(_0x1e9bfc)[a6_0x123d('0x2f')]());(0x0,fs_1[a6_0x123d('0x36')])(_0x1e9bfc);}catch(_0xd0dd){throw new Error(_0x4a033c);}if(_0x502159[a6_0x123d('0x57')]==0x0){throw new Error(_0x4a033c);}return _0x502159;}function invokeTasksUsingRunMany(_0x584e8b,_0x32641a,_0x5a690b,_0x25d5ac){let _0x372be7=0x0;const _0x13e1c9=[];for(const _0x5d60b0 of groupByTarget(_0x5a690b)){const _0x2fa89a=_0x5d60b0['configuration']?a6_0x123d('0x1b')+_0x5d60b0[a6_0x123d('0xb')]:'';const _0x5c5e67=_0x25d5ac>0x1?'\x20--parallel\x20--max-parallel='+_0x25d5ac:'';const _0x500485=a6_0x123d('0x7')+_0x5d60b0[a6_0x123d('0x21')]+'\x20'+_0x2fa89a+a6_0x123d('0x61')+_0x5d60b0[a6_0x123d('0x4b')][a6_0x123d('0x4d')](',')+'\x20'+_0x5d60b0['params']+_0x5c5e67;if(environment_1['VERBOSE_LOGGING']){output[a6_0x123d('0x44')]({'title':a6_0x123d('0x1d')+_0x500485+'\x27'});}try{(0x0,child_process_1[a6_0x123d('0x3f')])(_0x500485,{'stdio':[a6_0x123d('0x2b'),a6_0x123d('0x2b'),a6_0x123d('0x2b')],'env':Object[a6_0x123d('0x24')](Object[a6_0x123d('0x24')]({},process['env']),{'NX_CACHE_FAILURES':'true','NX_CLOUD_DISTRIBUTED_EXECUTION_ID':_0x32641a})});_0x13e1c9[a6_0x123d('0x50')](...readCompletedTasks(_0x584e8b,_0x32641a));}catch(_0x550b44){if(_0x550b44['status']===environment_1[a6_0x123d('0x5d')]){throw _0x550b44;}else{_0x372be7=0x1;_0x13e1c9['push'](...readCompletedTasks(_0x584e8b,_0x32641a));}}}return{'completedStatusCode':_0x372be7,'completedTasks':_0x13e1c9};}function groupByTarget(_0x256982){const _0x5a01dc=[];_0x256982[a6_0x123d('0x3c')](_0xeb76de=>{const _0x1a167d=_0x5a01dc[a6_0x123d('0x23')](_0x5e47e7=>_0x5e47e7[a6_0x123d('0x21')]===_0xeb76de[a6_0x123d('0x21')]&&_0x5e47e7[a6_0x123d('0xb')]===_0xeb76de['configuration']);if(_0x1a167d){_0x1a167d[a6_0x123d('0x4b')][a6_0x123d('0x50')](_0xeb76de['projectName']);}else{_0x5a01dc['push']({'target':_0xeb76de[a6_0x123d('0x21')],'projects':[_0xeb76de[a6_0x123d('0x3a')]],'params':_0xeb76de[a6_0x123d('0x66')],'configuration':_0xeb76de['configuration']});}});return _0x5a01dc;}function getAgentName(){if(process[a6_0x123d('0x5f')][a6_0x123d('0x60')]!==undefined){return process[a6_0x123d('0x5f')][a6_0x123d('0x60')];}else if(process['env'][a6_0x123d('0x42')]!==undefined&&process['env'][a6_0x123d('0x63')]){return process[a6_0x123d('0x5f')][a6_0x123d('0x63')];}else if(process[a6_0x123d('0x5f')][a6_0x123d('0x42')]!==undefined&&process['env'][a6_0x123d('0x11')]){return process[a6_0x123d('0x5f')]['CIRCLE_JOB'];}else{return a6_0x123d('0x65')+Math[a6_0x123d('0x68')](Math[a6_0x123d('0x0')]()*0x186a0);}}function createAgentLockfileAndSetUpListeners(_0x5eb723,_0x47a7ac,_0x416da3){const _0x3da275=_0x47a7ac[a6_0x123d('0xa')]||a6_0x123d('0x37');const _0x5086f7=_0x3da275+a6_0x123d('0x32');const _0x5a1f69=_0x5086f7+'/'+_0x416da3+a6_0x123d('0x4e');if(!(0x0,fs_1[a6_0x123d('0x8')])(_0x5086f7)){(0x0,fs_1[a6_0x123d('0x26')])(_0x5086f7,{'recursive':!![]});}const _0x3b8701=(0x0,fs_1['readdirSync'])(_0x5086f7);if(_0x3b8701[a6_0x123d('0x57')]){if(_0x3b8701[a6_0x123d('0xf')](_0x416da3+a6_0x123d('0x4e'))){output[a6_0x123d('0x5a')]({'title':a6_0x123d('0x40'),'bodyLines':[a6_0x123d('0x19'),'',a6_0x123d('0x30')]});process[a6_0x123d('0x17')](0x1);}output[a6_0x123d('0x35')]({'title':a6_0x123d('0x38'),'bodyLines':['We\x20have\x20detected\x20other\x20agents\x20running\x20in\x20this\x20workspace.\x20This\x20can\x20cause\x20unexpected\x20behavior.','','This\x20can\x20also\x20be\x20a\x20false\x20positive\x20caused\x20by\x20agents\x20that\x20did\x20not\x20shut\x20down\x20correctly.',a6_0x123d('0x9')]});}(0x0,fs_1[a6_0x123d('0x14')])(_0x5a1f69,'');process['on'](a6_0x123d('0x17'),_0x4db91e=>{cleanupAgentLockfile(_0x5a1f69,_0x4db91e);});process['on'](a6_0x123d('0xd'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x5eb723[a6_0x123d('0x67')](a6_0x123d('0x54'));cleanupAgentLockfile(_0x5a1f69,0x1);}));process['on'](a6_0x123d('0x2'),()=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x5eb723[a6_0x123d('0x67')]('Agent\x20was\x20terminated\x20via\x20SIGINT');cleanupAgentLockfile(_0x5a1f69,0x1);}));}function cleanupAgentLockfile(_0x7430a4,_0x33297b){if((0x0,fs_1[a6_0x123d('0x8')])(_0x7430a4)){(0x0,fs_1[a6_0x123d('0x36')])(_0x7430a4);process[a6_0x123d('0x17')](_0x33297b);}}function startAgent(){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5b9471=(0x0,environment_1[a6_0x123d('0x4f')])();if(!_0x5b9471){(0x0,print_run_group_error_1[a6_0x123d('0x5b')])();return process['exit'](0x1);}output[a6_0x123d('0x44')]({'title':a6_0x123d('0x27')});const _0x2f65a1=JSON[a6_0x123d('0x4')](stripJsonComments((0x0,fs_1[a6_0x123d('0x18')])(workspaceRoot+a6_0x123d('0x39'))[a6_0x123d('0x2f')]()))[a6_0x123d('0x55')][a6_0x123d('0x28')][a6_0x123d('0x12')];const _0x1d3898=getAgentName();const _0x4e47c9=new distributed_agent_api_1[(a6_0x123d('0x15'))](_0x2f65a1,_0x5b9471,_0x1d3898);createAgentLockfileAndSetUpListeners(_0x4e47c9,_0x2f65a1,_0x1d3898);return executeTasks(_0x2f65a1,_0x4e47c9)[a6_0x123d('0x4a')](_0x1320a1=>__awaiter(this,void 0x0,void 0x0,function*(){yield(0x0,metric_logger_1[a6_0x123d('0x25')])(_0x2f65a1);return _0x1320a1;}))['catch'](_0x1d10ae=>__awaiter(this,void 0x0,void 0x0,function*(){yield _0x4e47c9[a6_0x123d('0x67')](a6_0x123d('0x1f')+_0x1d10ae[a6_0x123d('0x45')]+'\x22');throw _0x1d10ae;}));});}exports[a6_0x123d('0x5')]=startAgent;