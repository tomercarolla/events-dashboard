const a3_0x254d=['defaults','post','endRun','then','message','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','axiosException','...','../../../utilities/nx-imports','headers','value','extractErrorMessage','axiosMultipleTries','mapRespToPerfEntry','response','/nx-cloud/runs/end','Invalid\x20end\x20run\x20response:\x20','CloudRunApi','assign','apiError','slice','__awaiter','runContext','getRunGroup','createMetricRecorder','messages','map','Run\x20Details:','status','createApiAxiosInstance','startRun','urls','next','gzip','RunStart','createReqBody','data','string','apply','promisify','throw','defineProperty','readFileSync','/nx-cloud/runs/start','devDependencies','zlib','Run\x20completion\x20responded\x20with\x20`undefined`.','VERBOSE_LOGGING','package.json','length','RUNNER_FAILURE_PERF_ENTRY','__esModule','getBranch','apiAxiosInstance','recordMetric','RunEnd.\x20Completed\x20tasks','stringify','success','from','api','machineInfo','error','Stack\x20Trace:','note','../../../utilities/metric-logger','nxCloudVersion','Invalid\x20end\x20run\x20response','terminalOutput'];(function(_0x55f62b,_0x254d49){const _0x8bc5a=function(_0x1f9e76){while(--_0x1f9e76){_0x55f62b['push'](_0x55f62b['shift']());}};_0x8bc5a(++_0x254d49);}(a3_0x254d,0x1cd));const a3_0x8bc5=function(_0x55f62b,_0x254d49){_0x55f62b=_0x55f62b-0x0;let _0x8bc5a=a3_0x254d[_0x55f62b];return _0x8bc5a;};'use strict';var __awaiter=this&&this[a3_0x8bc5('0x24')]||function(_0x165a10,_0xbb948a,_0x4981db,_0x13eb78){function _0x29f9c0(_0x5a51d9){return _0x5a51d9 instanceof _0x4981db?_0x5a51d9:new _0x4981db(function(_0xa2fae3){_0xa2fae3(_0x5a51d9);});}return new(_0x4981db||(_0x4981db=Promise))(function(_0x4e23d2,_0x59dfcd){function _0x29c706(_0x5a609e){try{_0xadef8f(_0x13eb78['next'](_0x5a609e));}catch(_0x46ca87){_0x59dfcd(_0x46ca87);}}function _0x4e2030(_0x2a5f04){try{_0xadef8f(_0x13eb78[a3_0x8bc5('0x37')](_0x2a5f04));}catch(_0x96005c){_0x59dfcd(_0x96005c);}}function _0xadef8f(_0x19fa77){_0x19fa77['done']?_0x4e23d2(_0x19fa77[a3_0x8bc5('0x19')]):_0x29f9c0(_0x19fa77['value'])[a3_0x8bc5('0x12')](_0x29c706,_0x4e2030);}_0xadef8f((_0x13eb78=_0x13eb78[a3_0x8bc5('0x35')](_0x165a10,_0xbb948a||[]))[a3_0x8bc5('0x2f')]());});};Object[a3_0x8bc5('0x38')](exports,a3_0x8bc5('0x42'),{'value':!![]});exports[a3_0x8bc5('0x20')]=void 0x0;const axios_1=require('../../../utilities/axios');const environment_1=require('../../../utilities/environment');const fs_1=require('fs');const zlib_1=require(a3_0x8bc5('0x3c'));const util_1=require('util');const metric_logger_1=require(a3_0x8bc5('0xb'));const {output}=require(a3_0x8bc5('0x17'));class CloudRunApi{constructor(_0x60a04d,_0x3369d4,_0x4e96d5,_0x395fbc){this[a3_0x8bc5('0x28')]=_0x60a04d;this[a3_0x8bc5('0x25')]=_0x3369d4;this[a3_0x8bc5('0x7')]=_0x395fbc;this[a3_0x8bc5('0x0')]=(0x0,axios_1[a3_0x8bc5('0x2c')])(_0x4e96d5);}[a3_0x8bc5('0x2d')](_0xb20716,_0x356414){var _0x15d294;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x352c7f=(0x0,metric_logger_1[a3_0x8bc5('0x27')])(a3_0x8bc5('0x2d'));try{const _0x536ec7={'meta':{'nxCloudVersion':this[a3_0x8bc5('0xc')]()},'branch':(0x0,environment_1[a3_0x8bc5('0x43')])(),'runGroup':(0x0,environment_1[a3_0x8bc5('0x26')])(),'distributedExecutionId':_0xb20716,'hashes':_0x356414};if(environment_1['VERBOSE_LOGGING']){output['note']({'title':a3_0x8bc5('0x31'),'bodyLines':['\x0a'+JSON[a3_0x8bc5('0x3')](_0x536ec7,null,0x2)]});}const _0x5c6385=yield(0x0,axios_1[a3_0x8bc5('0x1b')])(()=>this[a3_0x8bc5('0x0')][a3_0x8bc5('0x10')](a3_0x8bc5('0x3a'),_0x536ec7));_0x352c7f['recordMetric']((0x0,metric_logger_1[a3_0x8bc5('0x1c')])(_0x5c6385));if(_0x5c6385[a3_0x8bc5('0x33')]&&_0x5c6385['data'][a3_0x8bc5('0x13')]){this[a3_0x8bc5('0x28')]['message']=_0x5c6385['data'][a3_0x8bc5('0x13')];}if(!_0x5c6385[a3_0x8bc5('0x33')]||!_0x5c6385[a3_0x8bc5('0x33')]['urls']){this[a3_0x8bc5('0x28')][a3_0x8bc5('0x22')]='Invalid\x20Nx\x20Cloud\x20response:\x20'+JSON[a3_0x8bc5('0x3')](_0x5c6385[a3_0x8bc5('0x33')]);return{};}return _0x5c6385[a3_0x8bc5('0x33')][a3_0x8bc5('0x2e')];}catch(_0xcbaa96){_0x352c7f[a3_0x8bc5('0x1')](((_0x15d294=_0xcbaa96===null||_0xcbaa96===void 0x0?void 0x0:_0xcbaa96[a3_0x8bc5('0x15')])===null||_0x15d294===void 0x0?void 0x0:_0x15d294[a3_0x8bc5('0x1d')])?(0x0,metric_logger_1[a3_0x8bc5('0x1c')])(_0xcbaa96[a3_0x8bc5('0x15')]['response']):metric_logger_1['RUNNER_FAILURE_PERF_ENTRY']);this[a3_0x8bc5('0x28')][a3_0x8bc5('0x22')]=this[a3_0x8bc5('0x28')][a3_0x8bc5('0x1a')](_0xcbaa96,a3_0x8bc5('0x6'));return{};}});}['createReqBody'](_0x3b05e5,_0x1a29e6,_0x429dec){const _0x373c67={'meta':{'nxCloudVersion':this['nxCloudVersion']()},'tasks':_0x1a29e6,'run':_0x3b05e5,'linkId':_0x429dec,'machineInfo':this[a3_0x8bc5('0x7')]};return JSON[a3_0x8bc5('0x3')](_0x373c67);}['endRun'](_0x448bb7,_0x59922c,_0x1a39f8){var _0x22e89f,_0x2af338;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0x8bc5('0x28')][a3_0x8bc5('0x22')])return![];let _0x319700=this[a3_0x8bc5('0x32')](_0x448bb7,_0x59922c,_0x1a39f8);if(_0x319700[a3_0x8bc5('0x40')]>0x14*0x3e8*0x3e8){_0x319700=this['createReqBody'](_0x448bb7,_0x59922c['map'](_0x5540af=>Object[a3_0x8bc5('0x21')](Object['assign']({},_0x5540af),{'hashDetails':undefined})));}const _0xe5085=Buffer[a3_0x8bc5('0x5')](_0x319700);const _0x145ed7=yield(0x0,util_1[a3_0x8bc5('0x36')])(zlib_1[a3_0x8bc5('0x30')])(_0xe5085);const _0x34fd1d=(0x0,metric_logger_1['createMetricRecorder'])(a3_0x8bc5('0x11'));try{if(environment_1['VERBOSE_LOGGING']){const _0x2781e1=_0x59922c[a3_0x8bc5('0x29')](_0x1a134c=>{return Object['assign'](Object['assign']({},_0x1a134c),{'terminalOutput':_0x1a134c[a3_0x8bc5('0xe')]?_0x1a134c[a3_0x8bc5('0xe')][a3_0x8bc5('0x23')](0x0,0x14)+a3_0x8bc5('0x16'):undefined});});output['note']({'title':a3_0x8bc5('0x2'),'bodyLines':['\x0a'+JSON[a3_0x8bc5('0x3')](_0x2781e1,null,0x2)]});}const _0x5683e8=yield(0x0,axios_1['axiosMultipleTries'])(()=>this[a3_0x8bc5('0x0')][a3_0x8bc5('0x10')](a3_0x8bc5('0x1e'),_0x145ed7,{'headers':Object['assign'](Object[a3_0x8bc5('0x21')]({},this['apiAxiosInstance'][a3_0x8bc5('0xf')][a3_0x8bc5('0x18')]),{'Content-Encoding':a3_0x8bc5('0x30'),'Content-Type':'application/octet-stream'})}));if(_0x5683e8){_0x34fd1d[a3_0x8bc5('0x1')]((0x0,metric_logger_1[a3_0x8bc5('0x1c')])(_0x5683e8));if(_0x5683e8[a3_0x8bc5('0x33')]&&_0x5683e8[a3_0x8bc5('0x33')]['runUrl']&&_0x5683e8[a3_0x8bc5('0x33')]['status']==='success'){this['runContext']['runUrl']=_0x5683e8[a3_0x8bc5('0x33')]['runUrl'];return!![];}if(_0x5683e8[a3_0x8bc5('0x33')]&&_0x5683e8['data'][a3_0x8bc5('0x2b')]){this[a3_0x8bc5('0x28')][a3_0x8bc5('0x22')]=a3_0x8bc5('0x1f')+JSON[a3_0x8bc5('0x3')](_0x5683e8[a3_0x8bc5('0x33')][a3_0x8bc5('0x13')]);}else if(_0x5683e8[a3_0x8bc5('0x33')]&&typeof _0x5683e8[a3_0x8bc5('0x33')]===a3_0x8bc5('0x34')){if(_0x5683e8['data']!==a3_0x8bc5('0x4')){this[a3_0x8bc5('0x28')][a3_0x8bc5('0x22')]='Invalid\x20end\x20run\x20response:\x20'+JSON[a3_0x8bc5('0x3')](_0x5683e8[a3_0x8bc5('0x33')]);}}else{this[a3_0x8bc5('0x28')][a3_0x8bc5('0x22')]=a3_0x8bc5('0x1f')+JSON[a3_0x8bc5('0x3')](_0x5683e8[a3_0x8bc5('0x33')]);}if(environment_1[a3_0x8bc5('0x3e')]){output[a3_0x8bc5('0xa')]({'title':a3_0x8bc5('0xd'),'bodyLines':[JSON['stringify'](_0x5683e8[a3_0x8bc5('0x33')],null,0x2)]});}}else{output[a3_0x8bc5('0x8')]({'title':a3_0x8bc5('0x14'),'bodyLines':[a3_0x8bc5('0x3d'),a3_0x8bc5('0x2a'),JSON[a3_0x8bc5('0x3')](_0x448bb7,null,0x2),a3_0x8bc5('0x9'),JSON[a3_0x8bc5('0x3')](new Error()['stack'],null,0x2)]});}return![];}catch(_0x2f9391){_0x34fd1d['recordMetric'](((_0x22e89f=_0x2f9391===null||_0x2f9391===void 0x0?void 0x0:_0x2f9391[a3_0x8bc5('0x15')])===null||_0x22e89f===void 0x0?void 0x0:_0x22e89f[a3_0x8bc5('0x1d')])?(0x0,metric_logger_1['mapRespToPerfEntry'])(_0x2f9391['axiosException']['response']):metric_logger_1[a3_0x8bc5('0x41')]);const _0x4a8ac1=(_0x2af338=_0x2f9391[a3_0x8bc5('0x15')])!==null&&_0x2af338!==void 0x0?_0x2af338:_0x2f9391;this[a3_0x8bc5('0x28')][a3_0x8bc5('0x22')]=this[a3_0x8bc5('0x28')]['extractErrorMessage'](_0x4a8ac1,a3_0x8bc5('0x6'));return![];}});}[a3_0x8bc5('0xc')](){try{const _0x27d77e=JSON['parse']((0x0,fs_1[a3_0x8bc5('0x39')])(a3_0x8bc5('0x3f'))['toString']());return _0x27d77e[a3_0x8bc5('0x3b')]['@nrwl/nx-cloud'];}catch(_0x36c8d0){return'unknown';}}}exports[a3_0x8bc5('0x20')]=CloudRunApi;