const a1_0x8b30=['.commit','getMachineInfo','scan','CloudRemoteCache','toString','OutputObfuscator','toISOString','__awaiter','Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20record\x20its\x20run.','all','printMessages','cachePath','/runs/','indexOf','@nrwl/nx-cloud/lib/daemon/process-run-end','catch','accessToken','ErrorReporterApi','parseCommand','./cloud-enabled-life-cycle','url','extractGitSha','throw','encryptionKey','startRun','assign','Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20store\x20artifacts.','next','anyErrors','printCacheHitsMessage','cacheDirectory','maskedProperties','join','./id-generator','done','push','endRun','obfuscate','value','CloudEnabledLifeCycle','endsWith','CloudRunApi','error','processInBackground','./cloud-run.api','requests','writeFileSync','../../terminal-output/message-reporter','https://nx.app','enabled','__esModule','NX_CLOUD_DISTRIBUTED_EXECUTION_ID','fs-extra','E2EEncryption','MessageReporter','../../api/error-reporter.api','filter','../../../utilities/environment','tasks-hashes-','env','hash','../../file-storage/file-storage','path','EndOfRunMessage','length','AGENT_RUNNING_IN_DISTRIBUTED_EXECUTION','VERBOSE_LOGGING','../../../utilities/metric-logger','FileStorage','taskId','cloudEnabledTasksRunner','ACCESS_TOKEN','./node_modules/.cache/nx','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','map','apply','uploads','../../../utilities/nx-imports','getRunGroup','getBranch','daemon','then','../../terminal-output/output-obfuscator','exit','skipNxCache','lifeCycle','.nx.app','localhost','subscribe'];(function(_0x5997f1,_0x8b30d7){const _0x4d0e82=function(_0x2d3e9c){while(--_0x2d3e9c){_0x5997f1['push'](_0x5997f1['shift']());}};_0x4d0e82(++_0x8b30d7);}(a1_0x8b30,0x1dc));const a1_0x4d0e=function(_0x5997f1,_0x8b30d7){_0x5997f1=_0x5997f1-0x0;let _0x4d0e82=a1_0x8b30[_0x5997f1];return _0x4d0e82;};'use strict';var __awaiter=this&&this[a1_0x4d0e('0x41')]||function(_0x3f47cd,_0x42396e,_0x3484ef,_0x122e6f){function _0x2bff52(_0x47e65c){return _0x47e65c instanceof _0x3484ef?_0x47e65c:new _0x3484ef(function(_0x176d14){_0x176d14(_0x47e65c);});}return new(_0x3484ef||(_0x3484ef=Promise))(function(_0xb69dd3,_0x1ffe73){function _0x111985(_0x3901fe){try{_0x2e3b22(_0x122e6f[a1_0x4d0e('0x55')](_0x3901fe));}catch(_0x4345b4){_0x1ffe73(_0x4345b4);}}function _0x19a538(_0x4fed0b){try{_0x2e3b22(_0x122e6f[a1_0x4d0e('0x50')](_0x4fed0b));}catch(_0x563cba){_0x1ffe73(_0x563cba);}}function _0x2e3b22(_0x3ab6f2){_0x3ab6f2[a1_0x4d0e('0x3')]?_0xb69dd3(_0x3ab6f2[a1_0x4d0e('0x7')]):_0x2bff52(_0x3ab6f2[a1_0x4d0e('0x7')])['then'](_0x111985,_0x19a538);}_0x2e3b22((_0x122e6f=_0x122e6f[a1_0x4d0e('0x2c')](_0x3f47cd,_0x42396e||[]))[a1_0x4d0e('0x55')]());});};Object['defineProperty'](exports,a1_0x4d0e('0x13'),{'value':!![]});exports[a1_0x4d0e('0x27')]=void 0x0;const message_reporter_1=require(a1_0x4d0e('0x10'));const end_of_run_message_1=require('../../terminal-output/end-of-run-message');const output_obfuscator_1=require(a1_0x4d0e('0x33'));const cloud_enabled_life_cycle_1=require(a1_0x4d0e('0x4d'));const file_storage_1=require(a1_0x4d0e('0x1e'));const e2e_encryption_1=require('../../file-storage/e2e-encryption');const environment_1=require(a1_0x4d0e('0x1a'));const cloud_remote_cache_1=require('./cloud-remote-cache');const cloud_run_api_1=require(a1_0x4d0e('0xd'));const fs_1=require('fs');const path=require(a1_0x4d0e('0x1f'));const metric_logger_1=require(a1_0x4d0e('0x24'));const error_reporter_api_1=require(a1_0x4d0e('0x18'));const path_1=require(a1_0x4d0e('0x1f'));const fs_extra_1=require(a1_0x4d0e('0x15'));const id_generator_1=require(a1_0x4d0e('0x2'));const {tasksRunner,output,Cache}=require(a1_0x4d0e('0x2e'));function createApi(_0x5b3ce9,_0x371cec,_0x22817e){const _0x1f49d4=(0x0,environment_1[a1_0x4d0e('0x3b')])(_0x371cec);return new cloud_run_api_1[(a1_0x4d0e('0xa'))](_0x5b3ce9,_0x22817e,_0x371cec,_0x1f49d4);}function storeTaskHashes(_0x50b62e,_0x53b92a,_0x2d676f){const _0xca4897=JSON['stringify'](_0x50b62e[a1_0x4d0e('0x2b')](_0x338c08=>({'taskId':_0x338c08[a1_0x4d0e('0x26')],'hash':_0x338c08['hash']})));if(environment_1[a1_0x4d0e('0x23')]){output['note']({'title':'Executed\x20tasks\x20with\x20hashes:\x20'+_0xca4897});}(0x0,fs_1[a1_0x4d0e('0xf')])(path[a1_0x4d0e('0x1')](_0x53b92a,a1_0x4d0e('0x1b')+_0x2d676f),_0xca4897);}function onComplete({daemon,lifeCycle,options,remoteCache,api,outputObfuscator,runStartTime,messages,endOfRunMessage,taskExecutions,versionOfNxBefore133,inner,encryptionKey,fileStorage,uploadInCurrentProcess,runContext}){return __awaiter(this,void 0x0,void 0x0,function*(){const _0xf0ea96=new Date()['toISOString']();const _0x46a9ff=(0x0,environment_1[a1_0x4d0e('0x30')])();const _0x8641b2={'command':outputObfuscator[a1_0x4d0e('0x6')]((0x0,environment_1[a1_0x4d0e('0x4c')])()),'startTime':runStartTime,'endTime':_0xf0ea96,'distributedExecutionId':environment_1['NX_CLOUD_DISTRIBUTED_EXECUTION_ID'],'branch':_0x46a9ff,'scan':!![],'runGroup':(0x0,environment_1[a1_0x4d0e('0x2f')])(),'sha':_0x46a9ff?(0x0,environment_1[a1_0x4d0e('0x4f')])():undefined,'inner':inner};if(uploadInCurrentProcess){if(environment_1[a1_0x4d0e('0x22')]){storeTaskHashes(taskExecutions,options['cacheDirectory']||a1_0x4d0e('0x29'),environment_1[a1_0x4d0e('0x14')]);}try{yield remoteCache['waitForStoreRequestsToComplete']();}catch(_0x39d8a1){output[a1_0x4d0e('0xb')]({'title':a1_0x4d0e('0x54')});messages[a1_0x4d0e('0x44')]();process[a1_0x4d0e('0x34')](environment_1['DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE']);}try{yield api[a1_0x4d0e('0x5')](_0x8641b2,taskExecutions);}catch(_0x2db9f2){output[a1_0x4d0e('0xb')]({'title':a1_0x4d0e('0x42')});messages[a1_0x4d0e('0x44')]();process[a1_0x4d0e('0x34')](environment_1[a1_0x4d0e('0x2a')]);}yield(0x0,metric_logger_1['submitRunMetrics'])(options);}else{try{const _0x27412f=environment_1[a1_0x4d0e('0x28')]?environment_1[a1_0x4d0e('0x28')]:options[a1_0x4d0e('0x4a')];const _0x577f09=(0x0,id_generator_1['generateUniqueLinkId'])();yield daemon[a1_0x4d0e('0xc')](a1_0x4d0e('0x48'),{'encryptionKey':encryptionKey,'runnerOptions':Object['assign'](Object[a1_0x4d0e('0x53')]({},options),{'accessToken':_0x27412f}),'uploads':fileStorage[a1_0x4d0e('0x2d')],'runEnd':{'runData':_0x8641b2,'taskExecutions':taskExecutions,'linkId':_0x577f09}});runContext['runUrl']=(options[a1_0x4d0e('0x4e')]||a1_0x4d0e('0x11'))+a1_0x4d0e('0x46')+_0x577f09;}catch(_0x3cac54){output['warn']({'title':'Nx\x20Cloud\x20Problems','bodyLines':[_0x3cac54['message']||_0x3cac54[a1_0x4d0e('0x3e')]()]});}}if(versionOfNxBefore133){setTimeout(()=>{messages[a1_0x4d0e('0x44')]();if(!messages[a1_0x4d0e('0x56')]&&!inner){endOfRunMessage[a1_0x4d0e('0x57')]();}},0x0);}else{messages[a1_0x4d0e('0x44')]();if(!messages['anyErrors']&&!inner){endOfRunMessage[a1_0x4d0e('0x57')]();}}});}function createLifeCycle(_0xa52a80,_0x138973,_0x528cb1,_0x44b604){const _0x119ec8=new cloud_enabled_life_cycle_1[(a1_0x4d0e('0x8'))](_0xa52a80,_0x138973[a1_0x4d0e('0x58')],!!_0x138973[a1_0x4d0e('0x35')],_0x138973[a1_0x4d0e('0x3c')]===undefined?!![]:_0x138973['scan'],_0x138973['cacheableOperations']||[],_0x528cb1,_0x44b604);try{const {CompositeLifeCycle}=require(a1_0x4d0e('0x2e'));if(!CompositeLifeCycle)return _0x119ec8;return new CompositeLifeCycle([_0x138973['lifeCycle'],_0x119ec8]);}catch(_0xe904a9){return _0x119ec8;}}function fetchUrlsForKnownHashesUpfront(_0x18f500,_0x1cf19f,_0x32033a,_0x483c88){return __awaiter(this,void 0x0,void 0x0,function*(){let _0x8ce9a0=_0x32033a['map'](_0x39adbb=>_0x39adbb[a1_0x4d0e('0x1d')])[a1_0x4d0e('0x19')](_0x422f53=>!!_0x422f53);const _0x5863cc=new Cache(_0x483c88);if(!_0x483c88[a1_0x4d0e('0x35')]){const _0x15648b=yield Promise[a1_0x4d0e('0x43')](_0x8ce9a0[a1_0x4d0e('0x2b')](_0x1dc1b5=>{const _0x59949e=(0x0,path_1[a1_0x4d0e('0x1')])(_0x5863cc[a1_0x4d0e('0x45')],_0x1dc1b5+a1_0x4d0e('0x3a'));return(0x0,fs_extra_1['pathExists'])(_0x59949e);}));const _0x1d2ae4=[];for(let _0x2014e2=0x0;_0x2014e2<_0x15648b[a1_0x4d0e('0x21')];++_0x2014e2){if(_0x15648b[_0x2014e2]){_0x1d2ae4[a1_0x4d0e('0x4')](_0x8ce9a0[_0x2014e2]);}}_0x8ce9a0=_0x1d2ae4;}if(_0x8ce9a0['length']>0x0){const _0x5f449e=_0x18f500[a1_0x4d0e('0x52')](environment_1['NX_CLOUD_DISTRIBUTED_EXECUTION_ID'],_0x8ce9a0);for(const _0x108481 of _0x8ce9a0){_0x1cf19f[a1_0x4d0e('0xe')][_0x108481]=_0x5f449e;}}});}function isConnectedToPrivateCloud(_0x44a7e3){if(!_0x44a7e3[a1_0x4d0e('0x4e')])return![];if(_0x44a7e3[a1_0x4d0e('0x4e')][a1_0x4d0e('0x9')](a1_0x4d0e('0x37')))return![];if(_0x44a7e3[a1_0x4d0e('0x4e')][a1_0x4d0e('0x47')](a1_0x4d0e('0x38'))>-0x1)return![];return!![];}function cloudEnabledTasksRunner(_0x54b8a4,_0x552950,_0xbbb8d4,_0x39c829=![]){var _0x5b1073;const _0x19ba4f={'statuses':{},'scheduledTasks':[],'requests':{},'allTasks':_0x54b8a4};const _0x57c495=_0x552950[a1_0x4d0e('0x36')]===undefined;const _0x1d0f37=[];const _0x134a68=new message_reporter_1[(a1_0x4d0e('0x17'))](_0x552950);const _0xd47c9a=createApi(_0x134a68,_0x552950,_0x19ba4f);const _0x5cc1e5=new end_of_run_message_1[(a1_0x4d0e('0x20'))](_0x19ba4f,_0x1d0f37);const _0x2e1e17=new output_obfuscator_1[(a1_0x4d0e('0x3f'))](_0x552950[a1_0x4d0e('0x0')]);const _0x49a451=new Date()[a1_0x4d0e('0x40')]();const _0x4072c7=createLifeCycle(_0x19ba4f,_0x552950,_0x2e1e17,_0x1d0f37);const _0x28b109=environment_1['ENCRYPTION_KEY']||_0x552950[a1_0x4d0e('0x51')];const _0x35bc85=new e2e_encryption_1[(a1_0x4d0e('0x16'))](_0x28b109);const _0x59cc54=new error_reporter_api_1[(a1_0x4d0e('0x4b'))](_0x552950);const _0x1556af=!!environment_1[a1_0x4d0e('0x22')]||!((_0x5b1073=_0xbbb8d4[a1_0x4d0e('0x31')])===null||_0x5b1073===void 0x0?void 0x0:_0x5b1073[a1_0x4d0e('0x12')]())||isConnectedToPrivateCloud(_0x552950);const _0x91dcb4=new file_storage_1[(a1_0x4d0e('0x25'))](_0x35bc85,_0x59cc54,![],_0x1556af);const _0x3d24f5=new cloud_remote_cache_1[(a1_0x4d0e('0x3d'))](_0x134a68,_0xd47c9a,_0x19ba4f,_0x91dcb4);fetchUrlsForKnownHashesUpfront(_0xd47c9a,_0x19ba4f,_0x54b8a4,_0x552950);delete process[a1_0x4d0e('0x1c')][a1_0x4d0e('0x14')];const _0x5e8340=tasksRunner(_0x54b8a4,Object[a1_0x4d0e('0x53')](Object[a1_0x4d0e('0x53')]({},_0x552950),{'remoteCache':_0x3d24f5,'lifeCycle':_0x4072c7}),_0xbbb8d4);if(_0x5e8340[a1_0x4d0e('0x39')]){const {Subject}=require('rxjs/internal/Subject');const _0x57ad37=new Subject();_0x5e8340[a1_0x4d0e('0x39')]({'next':_0x306024=>_0x57ad37[a1_0x4d0e('0x55')](_0x306024),'error':_0x179d8a=>_0x57ad37[a1_0x4d0e('0xb')](_0x179d8a),'complete':()=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0xbbb8d4[a1_0x4d0e('0x31')],'lifeCycle':_0x4072c7,'options':_0x552950,'remoteCache':_0x3d24f5,'api':_0xd47c9a,'outputObfuscator':_0x2e1e17,'runStartTime':_0x49a451,'messages':_0x134a68,'endOfRunMessage':_0x5cc1e5,'taskExecutions':_0x1d0f37,'versionOfNxBefore133':_0x57c495,'inner':_0x39c829,'encryptionKey':_0x28b109,'fileStorage':_0x91dcb4,'uploadInCurrentProcess':_0x1556af,'runContext':_0x19ba4f});_0x57ad37['complete']();})});return _0x57ad37;}else{return _0x5e8340[a1_0x4d0e('0x32')](_0x32e05b=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0xbbb8d4[a1_0x4d0e('0x31')],'lifeCycle':_0x4072c7,'options':_0x552950,'remoteCache':_0x3d24f5,'api':_0xd47c9a,'outputObfuscator':_0x2e1e17,'runStartTime':_0x49a451,'messages':_0x134a68,'endOfRunMessage':_0x5cc1e5,'taskExecutions':_0x1d0f37,'versionOfNxBefore133':_0x57c495,'inner':_0x39c829,'encryptionKey':_0x28b109,'fileStorage':_0x91dcb4,'uploadInCurrentProcess':_0x1556af,'runContext':_0x19ba4f});return _0x32e05b;}))[a1_0x4d0e('0x49')](_0x252f29=>__awaiter(this,void 0x0,void 0x0,function*(){yield onComplete({'daemon':_0xbbb8d4[a1_0x4d0e('0x31')],'lifeCycle':_0x4072c7,'options':_0x552950,'remoteCache':_0x3d24f5,'api':_0xd47c9a,'outputObfuscator':_0x2e1e17,'runStartTime':_0x49a451,'messages':_0x134a68,'endOfRunMessage':_0x5cc1e5,'taskExecutions':_0x1d0f37,'versionOfNxBefore133':_0x57c495,'inner':_0x39c829,'encryptionKey':_0x28b109,'fileStorage':_0x91dcb4,'uploadInCurrentProcess':_0x1556af,'runContext':_0x19ba4f});throw _0x252f29;}));}}exports[a1_0x4d0e('0x27')]=cloudEnabledTasksRunner;